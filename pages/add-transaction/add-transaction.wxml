<!--pages/add-transaction/add-transaction.wxml-->
<view class="container">
  <form bindsubmit="onSubmit">
    <!-- 基本信息 -->
    <view class="card">
      <view class="card-header">{{isEdit ? '编辑' : '添加'}}交易记录</view>
      <view class="card-body">
        
        <!-- 用户选择 -->
        <view class="form-item">
          <view class="label">选择用户 *</view>
          <picker 
            bindchange="onUserChange" 
            value="{{userIndex}}" 
            range="{{userOptions}}"
            range-key="name"
            disabled="{{users.length === 0}}"
          >
            <view class="picker">
              {{selectedUser ? selectedUser.name : '请选择用户'}}
              <text class="arrow">></text>
            </view>
          </picker>
        </view>

        <!-- 股票代码 -->
        <view class="form-item">
          <view class="label">股票代码 *</view>
          <input 
            class="input" 
            placeholder="如: 000001" 
            value="{{formData.stockCode}}"
            bindinput="onInputChange"
            data-field="stockCode"
            maxlength="6"
          ></input>
        </view>

        <!-- 股票名称 -->
        <view class="form-item">
          <view class="label">股票名称 *</view>
          <input 
            class="input" 
            placeholder="如: 平安银行" 
            value="{{formData.stockName}}"
            bindinput="onInputChange"
            data-field="stockName"
          ></input>
        </view>

        <!-- 交易类型 -->
        <view class="form-item">
          <view class="label">交易类型 *</view>
          <picker 
            bindchange="onTypeChange" 
            value="{{typeIndex}}" 
            range="{{typeOptions}}"
            range-key="label"
          >
            <view class="picker">
              {{typeOptions[typeIndex].label}}
              <text class="arrow">></text>
            </view>
          </picker>
        </view>

        <!-- 数量和价格 -->
        <view class="form-row">
          <view class="form-item flex">
            <view class="label">数量 *</view>
            <input 
              class="input" 
              placeholder="股数" 
              value="{{formData.quantity}}"
              bindinput="onInputChange"
              data-field="quantity"
              type="number"
            ></input>
          </view>
          <view class="form-item flex">
            <view class="label">价格 *</view>
            <input 
              class="input" 
              placeholder="单价" 
              value="{{formData.price}}"
              bindinput="onInputChange"
              data-field="price"
              type="digit"
            ></input>
          </view>
        </view>

        <!-- 交易日期 -->
        <view class="form-item">
          <view class="label">交易日期 *</view>
          <picker 
            mode="date" 
            value="{{formData.transactionDate}}" 
            bindchange="onDateChange"
          >
            <view class="picker">
              {{formData.transactionDate || '请选择日期'}}
              <text class="arrow">></text>
            </view>
          </picker>
        </view>

        <!-- 计算结果 -->
        <view class="form-item" wx:if="{{totalAmount > 0}}">
          <view class="label">总金额</view>
          <view class="result">¥{{totalAmount}}</view>
        </view>

        <!-- 备注 -->
        <view class="form-item">
          <view class="label">备注</view>
          <textarea 
            class="textarea" 
            placeholder="可选备注信息" 
            value="{{formData.notes}}"
            bindinput="onInputChange"
            data-field="notes"
            maxlength="200"
          ></textarea>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <button 
        class="btn btn-primary" 
        formType="submit"
        disabled="{{!canSubmit}}"
      >
        {{isEdit ? '更新' : '添加'}}交易
      </button>
      
      <button 
        class="btn btn-ghost" 
        bindtap="onCancel"
        style="margin-top: 24rpx;"
      >
        取消
      </button>
      
      <button 
        class="btn btn-danger" 
        bindtap="onDelete"
        style="margin-top: 24rpx;"
        wx:if="{{isEdit}}"
      >
        删除交易
      </button>
    </view>
  </form>
</view>