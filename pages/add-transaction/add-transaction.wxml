<!--pages/add-transaction/add-transaction.wxml-->
<view class="container">
  <form bindsubmit="onSubmit">
    <!-- 基本信息 -->
    <view class="card">
      <view class="card-header">{{isEdit ? '编辑' : '添加'}}交易记录</view>
      <view class="card-body">
        
        <!-- 用户选择 -->
        <view class="form-item">
          <view class="label">
            <text class="required">*</text>
            选择用户
          </view>
          <picker 
            bindchange="onUserChange" 
            value="{{userIndex}}" 
            range="{{userOptions}}"
            range-key="name"
            disabled="{{users.length === 0}}"
          >
            <view class="picker {{!selectedUser ? 'error' : ''}}">
              {{selectedUser ? selectedUser.name : '请选择用户'}}
              <text class="arrow">></text>
            </view>
          </picker>
          <view wx:if="{{!selectedUser}}" class="error-text">
            请选择用户
          </view>
        </view>

        <!-- 股票代码 -->
        <view class="form-item">
          <view class="label">
            <text class="required">*</text>
            股票代码
          </view>
          <input 
            class="input" 
            placeholder="请输入6位股票代码，如: 000001" 
            value="{{formData.stockCode}}"
            bindinput="onInputChange"
            data-field="stockCode"
            maxlength="6"
            type="number"
          ></input>
          <view wx:if="{{formData.stockCode.trim() && formData.stockCode.trim().length !== 6}}" class="error-text">
            股票代码必须为6位数字
          </view>
        </view>

        <!-- 股票名称 -->
        <view class="form-item">
          <view class="label">
            <text class="required">*</text>
            股票名称
          </view>
          <input 
            class="input" 
            placeholder="请输入股票名称，如: 平安银行" 
            value="{{formData.stockName}}"
            bindinput="onInputChange"
            data-field="stockName"
          ></input>
          <view wx:if="{{!formData.stockName.trim()}}" class="error-text">
            请输入股票名称
          </view>
        </view>

        <!-- 交易类型 -->
        <view class="form-item">
          <view class="label">
            <text class="required">*</text>
            交易类型
          </view>
          <picker 
            bindchange="onTypeChange" 
            value="{{typeIndex}}" 
            range="{{typeOptions}}"
            range-key="label"
          >
            <view class="picker">
              {{typeOptions[typeIndex].label}}
              <text class="arrow">></text>
            </view>
          </picker>
        </view>

        <!-- 数量和价格 -->
        <view class="form-row">
          <view class="form-item flex">
            <view class="label">
              <text class="required">*</text>
              数量
            </view>
            <input 
              class="input" 
              placeholder="请输入股数" 
              value="{{formData.quantity}}"
              bindinput="onInputChange"
              data-field="quantity"
              type="number"
            ></input>
            <view wx:if="{{formData.quantity && formData.quantity <= 0}}" class="error-text">
              数量必须大于0
            </view>
          </view>
          <view class="form-item flex">
            <view class="label">
              <text class="required">*</text>
              价格
            </view>
            <input 
                          class="input" 
              placeholder="请输入单价" 
              value="{{formData.price}}"
              bindinput="onInputChange"
              data-field="price"
              type="digit"
            ></input>
            <view wx:if="{{formData.price && (formData.price <= 0)}}" class="error-text">
              价格必须大于0
            </view>
          </view>
        </view>

        <!-- 交易日期 -->
        <view class="form-item">
          <view class="label">
            <text class="required">*</text>
            交易日期
          </view>
          <picker 
            mode="date" 
            value="{{formData.transactionDate}}" 
            bindchange="onDateChange"
          >
            <view class="picker">
              {{formData.transactionDate || '请选择交易日期'}}
              <text class="arrow">></text>
            </view>
          </picker>
          <view wx:if="{{!formData.transactionDate}}" class="error-text">
            请选择交易日期
          </view>
        </view>

        <!-- 计算结果 -->
        <view class="form-item" wx:if="{{totalAmount > 0}}">
          <view class="label">总金额</view>
          <view class="result">¥{{totalAmount}}</view>
        </view>

        <!-- 备注 -->
        <view class="form-item">
          <view class="label">备注</view>
          <textarea 
            class="textarea" 
            placeholder="可选备注信息" 
            value="{{formData.notes}}"
            bindinput="onInputChange"
            data-field="notes"
            maxlength="200"
          ></textarea>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <button 
        class="btn btn-primary" 
        formType="submit"
        disabled="{{!canSubmit}}"
      >
        {{isEdit ? '更新' : '添加'}}交易
      </button>
      
      <button 
        class="btn btn-ghost" 
        bindtap="onCancel"
        style="margin-top: 24rpx;"
      >
        取消
      </button>
      
      <button 
        class="btn btn-danger" 
        bindtap="onDelete"
        style="margin-top: 24rpx;"
        wx:if="{{isEdit}}"
      >
        删除交易
      </button>
    </view>
  </form>
</view>